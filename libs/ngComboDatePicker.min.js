/*
 * ngComboDatePicker v1.0.0
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@"},controller:["$scope",function(e){function n(e){var n=null;return void 0!==e&&null!==e&&(e instanceof Date?n=e:("number"==typeof e||"string"==typeof e)&&(n=new Date(isNaN(e)?e:parseInt(e,10)))),n}function t(e,n){var t=31;return(4==e||6==e||9==e||11==e)&&(t=30),2==e&&(t=n%4==0&&n%100!=0?29:28),t}e.ngModel=n(e.ngModel),null==e.ngModel&&(e.ngModel=new Date);var a=n(e.ngDate);if(null!=a&&(e.ngModel=a),e.ngOrder="string"!=typeof e.ngOrder?"dmy":e.ngOrder.toLowerCase(),e.minDate=n(e.ngMinDate),null==e.ngMinDate){var o=new Date;e.minDate=new Date(o.getFullYear()-100,o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds())}e.maxDate=n(e.ngMaxDate),null==e.maxDate&&(e.maxDate=new Date),e.ngModel<e.minDate&&(e.ngModel=e.minDate),e.ngModel>e.maxDate&&(e.ngModel=e.maxDate),e.years=[];for(var g=e.minDate.getFullYear();g<=e.maxDate.getFullYear();g++)e.years.push(g);var l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==e.ngMonths&&null!==e.ngMonths){if("string"==typeof e.ngMonths){var r=e.ngMonths.split(",");12==r.length&&(l=r)}Array.isArray(e.ngMonths)&&12==e.ngMonths.length&&(l=e.ngMonths)}e.updateMonthList=function(){var n=e.ngModel.getFullYear()==e.minDate.getFullYear()?e.minDate.getMonth():0,t=e.ngModel.getFullYear()==e.maxDate.getFullYear()?e.maxDate.getMonth():11;e.months=[];for(var a=n;t>=a;a++)e.months.push({index:a,name:l[a]})},e.updateDateList=function(){var n=1;e.ngModel.getMonth()==e.minDate.getMonth()&&e.ngModel.getFullYear()==e.minDate.getFullYear()&&(n=e.minDate.getDate());var a=t(e.ngModel.getMonth()+1,e.ngModel.getFullYear());e.ngModel.getMonth()==e.maxDate.getMonth()&&e.ngModel.getFullYear()==e.maxDate.getFullYear()&&(a=e.maxDate.getDate()),e.dates=[];for(var o=n;a>=o;o++)e.dates.push(o)},e.modelUpdated=function(){e.date=e.ngModel.getDate(),e.month=e.ngModel.getMonth(),e.year=e.ngModel.getFullYear(),e.updateMonthList(),e.updateDateList()},e.$watch("ngModel",function(){e.modelUpdated()}),e.onChange=function(){var n=t(e.month+1,e.year);e.ngModel=new Date(e.year,e.month,e.date>n?n:e.date,e.ngModel.getHours(),e.ngModel.getMinutes(),e.ngModel.getSeconds(),e.ngModel.getMilliseconds()),e.updateMonthList(),e.updateDateList()}}],link:function(e,n){for(var t=angular.element,a=t(n[0]).children(),o=e.ngOrder.split(""),g=0;g<o.length;g++)"d"==o[g]&&t(n[0]).append(a[0]),"m"==o[g]&&t(n[0]).append(a[1]),"y"==o[g]&&t(n[0]).append(a[2])},template:function(){var e='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.index as month.name for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year for year in years"></select>';return e}}});
